!function r(s,u,a){function l(e,t){if(!u[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=u[e]={exports:{}};s[e][0].call(o.exports,function(t){return l(s[e][1][t]||t)},o,o.exports,r,s,u,a)}return u[e].exports}for(var h="function"==typeof require&&require,t=0;t<a.length;t++)l(a[t]);return l}({1:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],2:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],3:[function(t,e,f){var u=/%[sdj%]/g;f.format=function(t){if(!w(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(a(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,o=n.length,r=String(t).replace(u,function(t){if("%%"===t)return"%";if(o<=i)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),s=n[i];i<o;s=n[++i])b(s)||!l(s)?r+=" "+s:r+=" "+a(s);return r},f.deprecate=function(t,e){if(_(global.process))return function(){return f.deprecate(t,e).apply(this,arguments)};if(!0===process.noDeprecation)return t;var i=!1;return function(){if(!i){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),i=!0}return t.apply(this,arguments)}};var n,o={};function a(t,e){var i={seen:[],stylize:s};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),g(e)?i.showHidden=e:e&&f._extend(i,e),_(i.showHidden)&&(i.showHidden=!1),_(i.depth)&&(i.depth=2),_(i.colors)&&(i.colors=!1),_(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=r),d(i,t,i.depth)}function r(t,e){var i=a.styles[e];return i?"["+a.colors[i][0]+"m"+t+"["+a.colors[i][1]+"m":t}function s(t,e){return t}function d(e,i,n){if(e.customInspect&&i&&P(i.inspect)&&i.inspect!==f.inspect&&(!i.constructor||i.constructor.prototype!==i)){var t=i.inspect(n,e);return w(t)||(t=d(e,t,n)),t}var o=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(w(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(x(e))return t.stylize(""+e,"number");if(g(e))return t.stylize(""+e,"boolean");if(b(e))return t.stylize("null","null")}(e,i);if(o)return o;var r,s=Object.keys(i),u=(r={},s.forEach(function(t,e){r[t]=!0}),r);if(e.showHidden&&(s=Object.getOwnPropertyNames(i)),T(i)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return y(i);if(0===s.length){if(P(i)){var a=i.name?": "+i.name:"";return e.stylize("[Function"+a+"]","special")}if(S(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(M(i))return e.stylize(Date.prototype.toString.call(i),"date");if(T(i))return y(i)}var l,h="",c=!1,p=["{","}"];m(i)&&(c=!0,p=["[","]"]),P(i)&&(h=" [Function"+(i.name?": "+i.name:"")+"]");return S(i)&&(h=" "+RegExp.prototype.toString.call(i)),M(i)&&(h=" "+Date.prototype.toUTCString.call(i)),T(i)&&(h=" "+y(i)),0!==s.length||c&&0!=i.length?n<0?S(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),l=c?function(e,i,n,o,t){for(var r=[],s=0,u=i.length;s<u;++s)O(i,String(s))?r.push(v(e,i,n,o,String(s),!0)):r.push("");return t.forEach(function(t){t.match(/^\d+$/)||r.push(v(e,i,n,o,t,!0))}),r}(e,i,n,u,s):s.map(function(t){return v(e,i,n,u,t,c)}),e.seen.pop(),function(t,e,i){if(60<t.reduce(function(t,e){return 0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(l,h,p)):p[0]+h+p[1]}function y(t){return"["+Error.prototype.toString.call(t)+"]"}function v(t,e,i,n,o,r){var s,u,a;if((a=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?u=a.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):a.set&&(u=t.stylize("[Setter]","special")),O(n,o)||(s="["+o+"]"),u||(t.seen.indexOf(a.value)<0?-1<(u=b(i)?d(t,a.value,null):d(t,a.value,i-1)).indexOf("\n")&&(u=r?u.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+u.split("\n").map(function(t){return"   "+t}).join("\n")):u=t.stylize("[Circular]","special")),_(s)){if(r&&o.match(/^\d+$/))return u;s=(s=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+u}function m(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function b(t){return null===t}function x(t){return"number"==typeof t}function w(t){return"string"==typeof t}function _(t){return void 0===t}function S(t){return l(t)&&"[object RegExp]"===i(t)}function l(t){return"object"==typeof t&&null!==t}function M(t){return l(t)&&"[object Date]"===i(t)}function T(t){return l(t)&&("[object Error]"===i(t)||t instanceof Error)}function P(t){return"function"==typeof t}function i(t){return Object.prototype.toString.call(t)}function h(t){return t<10?"0"+t.toString(10):t.toString(10)}f.debuglog=function(e){if(_(n)&&(n=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(n)){var i=process.pid;o[e]=function(){var t=f.format.apply(f,arguments);console.error("%s %d: %s",e,i,t)}}else o[e]=function(){};return o[e]},(f.inspect=a).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},f.isArray=m,f.isBoolean=g,f.isNull=b,f.isNullOrUndefined=function(t){return null==t},f.isNumber=x,f.isString=w,f.isSymbol=function(t){return"symbol"==typeof t},f.isUndefined=_,f.isRegExp=S,f.isObject=l,f.isDate=M,f.isError=T,f.isFunction=P,f.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},f.isBuffer=t("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(t,e){return Object.prototype.hasOwnProperty.call(t,e)}f.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[h(t.getHours()),h(t.getMinutes()),h(t.getSeconds())].join(":"),[t.getDate(),c[t.getMonth()],e].join(" ")),f.format.apply(f,arguments))},f.inherits=t("inherits"),f._extend=function(t,e){if(!e||!l(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}},{"./support/isBuffer":2,inherits:1}],4:[function(t,e,i){"use strict";function n(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(e.exports=n).prototype.setVolume=function(t,e){var i=this.muted;this.muted=0===t||e||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),i&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},n.prototype.setMute=function(t){this.setVolume(null,t)},n.prototype.playLoopSound=function(t,i,n,o,r,s){var u=this.audioManager,a=u.settings.defaultFade,e=u.settings.crossFading,l=this.loopSound,h=l&&l.id;if(i=Math.max(0,Math.min(1,i||1)),this.loopId=t,this.loopVol=i,!u.muted&&!this.muted){if(t===h&&l)return l.play(i*this.volume,n,o),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(l=null,!this.nextLoop||this.nextLoop.id!==t){var c=this;e?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=u.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return c.nextLoop.unload(),void(c.nextLoop=null);p(c.loopSound),d()})):(this.nextLoop=u.createSound(t,this.id),p(this.loopSound,d))}}function p(t,e){if(!t)return e&&e();t.stopping||t.stop(function(){return u.freeSound(t),t=null,e&&e()})}function f(){var e=c.loopSound=c.nextLoop;c.nextLoop=null,e&&(e.setLoop(!0,r,s),e.fade=a,e.load(function(t){if(t)return e.unload(),void(c.loopSound=null);e.play(i*c.volume,n,o)}))}function d(){c.loopSound=null,window.setTimeout(f,0)}}},{}],5:[function(t,e,i){"use strict";var n=window.AudioContext||window.webkitAudioContext,o=t("./OrderedList"),r=t("./SoundBuffered.js"),s=t("./SoundGroup.js"),u=t("./AudioChannel.js"),a=t("./ISound.js");function l(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new o(function(){return 1}),this.soundGroupArchive=new o(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,e){return t+e+".mp3"},getSoundConstructor:function(){return null}};for(var e=0;e<t.length;e++){var i=t[e];this.channels[i]=new u(i)}a.prototype.audioManager=this,s.prototype.audioManager=this,u.prototype.audioManager=this}n||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),r=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),r=a)),e.exports=l,e.exports.ISound=a,l.prototype.init=function(){if(!this.audioContext&&n)for(var t in this.audioContext=new n,r.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},l.prototype.getEmptySound=function(t,e){var i,n=this.settings.getSoundConstructor(t,e);return n?i=new n:(0<this.freeSoundPool.length?(i=this.freeSoundPool.pop()).init():i=new r,i)},l.prototype.setup=function(t){for(var e in t){var i=t[e];this.setVolume(e,i.volume,i.muted)}},l.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new u(t))},l.prototype.setVolume=function(t,e,i){var n=this.channels[t];n&&n.setVolume(e,i)},l.prototype.setMute=function(t){for(var e in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var i=this.channels[e];if(i.loopSound)if(t)i.loopSound.stop();else{var n=i.muted;i.muted=!0,i.setVolume(null,n)}}},l.prototype.loadSound=function(t,e){var i=this.createSound(t);return i.load(e),i},l.prototype.createSound=function(t,e){var i=this.getSound(t);return i||((i=this.soundsById[t]=this.getEmptySound(e,t)).setId(t),i)},l.prototype.createSoundPermanent=function(t,e){var i=this.getSound(t);if(i)return i;var n=this.settings.getSoundConstructor(e,t)||r;return(i=this.permanentSounds[t]=new n).setId(t),i},l.prototype.getSound=function(t){var e=this.permanentSounds[t];return e||((e=this.soundsById[t])?e:(e=this.soundArchiveById[t])?(this.soundArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=e):null)},l.prototype.getSoundGroup=function(t){var e=this.soundGroupsById[t];return e||((e=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundGroupArchiveById[t],e.verifySounds(),this.soundGroupsById[t]=e):null)},l.prototype.freeSound=function(t){var e=t.id;this.soundsById[e]&&delete this.soundsById[e],this.soundArchiveById[e]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[e]),t.unload(),t instanceof r&&this.freeSoundPool.push(t)},l.prototype.playLoopSound=function(t,e,i,n,o,r,s){var u=this.channels[t];if(!u)return console.warn('Channel id "'+t+'" does not exist.');u.playLoopSound(e,i,n,o,r,s)},l.prototype.stopLoopSound=function(t){var e=this,i=this.channels[t];if(!i)return console.warn('Channel id "'+t+'" does not exist.');var n=i.loopSound;i.loopId=null,n&&n.stop(function(){e.freeSound(n),i.loopSound=null})},l.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},l.prototype.release=function(){var t,e,i,n=this.settings.maxSoundGroup,o=this.settings.maxUsedMemory,r={};for(t in this.channels){var s=this.channels[t];s.loopSound&&(r[s.loopSound.id]=!0)}for(t in this.soundGroupsById)(e=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(e),this.soundGroupArchiveById[t]=e,delete this.soundGroupsById[t];for(t in this.soundsById)r[t]||((i=this.soundsById[t]).poolRef=this.soundArchive.add(i),this.soundArchiveById[t]=i,delete this.soundsById[t]);for(var u=this.soundGroupArchive.getCount();n<u&&(e=this.soundGroupArchive.popFirst());)e.poolRef=null,delete this.soundGroupArchiveById[e.id],--u;for(;this.usedMemory>o&&(i=this.soundArchive.popFirst());)i.poolRef=null,delete this.soundArchiveById[i.id],this.freeSound(i)},l.prototype.playSound=function(t,e,i,n,o){if(!this.muted){var r=this.channels[t];if(!r.muted){var s=this.getSound(e);i=i||1,(s=s||this.createSound(e,t)).play(r.volume*i,n,o)}}},l.prototype.playSoundGroup=function(t,e,i,n,o){if(!this.muted){var r=this.channels[t];if(r&&!r.muted){var s=this.getSoundGroup(e);if(!s)return console.warn('SoundGroup "'+e+'" does not exist.');i=i||1,s.play(i*r.volume,n,o)}}},l.prototype.createSoundGroup=function(t,e,i){if(!this.getSoundGroup(t)){var n=new s(t,e.id,e.vol,e.pitch,i);this.soundGroupsById[t]=n}},l.prototype.createSoundGroups=function(t,e){var i=void 0!==e&&this.channels[e].muted;for(var n in t)this.createSoundGroup(n,t[n],i)}},{"./AudioChannel.js":4,"./ISound.js":6,"./OrderedList":7,"./Sound.js":8,"./SoundBuffered.js":9,"./SoundGroup.js":10}],6:[function(t,e,i){"use strict";function n(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(e.exports=n).prototype.setId=function(t){this.id=t,this._loaded=!1},n.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},n.prototype._finalizeLoad=function(t){var e=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var i=0;i<this._onLoadQueuedCallback.length;i++)this._onLoadQueuedCallback[i](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<e)&&this._play(),this._playTriggered=0)},n.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},n.prototype.play=function(t,e,i){if(null!=t&&this.setVolume(t),null!=e&&this.setPan(e),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(i):this._play(i)},n.prototype.init=function(){},n.prototype.setVolume=function(t){this.volume=t},n.prototype.setPan=function(t){this.pan=t},n.prototype.setLoop=function(t){this.loop=t},n.prototype.setPitch=function(t){this.pitch=t},n.prototype._updatePlayPitch=function(t){},n.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},n.prototype.stop=function(t){return this.playing=!1,t&&t()},n.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},n.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],7:[function(t,e,i){"use strict";function r(t,e,i,n){this.object=t,this.previous=e,this.next=i,this.container=n}function n(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}n.prototype.add=function(t){var e=new r(t,null,null,this);if(this.count+=1,null===this.first)return this.first=e,this.last=e;var i=this.cmpFunc(t,this.first.object);if(i<0)return e.next=this.first,this.first.previous=e,this.first=e;var n,o=this.cmpFunc(t,this.last.object);if(0<=o)return e.previous=this.last,this.last.next=e,this.last=e;if(i+o<0){for(n=this.first.next;0<=this.cmpFunc(t,n.object);)n=n.next;e.next=n,e.previous=n.previous,e.previous.next=e,n.previous=e}else{for(n=this.last.previous;this.cmpFunc(t,n.object)<0;)n=n.previous;e.previous=n,e.next=n.next,e.next.previous=e,n.next=e}return e},n.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},n.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},n.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},n.prototype.possess=function(t){return t&&t.container===this},n.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},n.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},n.prototype.getFirst=function(){return this.first&&this.first.object},n.prototype.getLast=function(){return this.last&&this.last.object},n.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},n.prototype.getCount=function(){return this.count},n.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},n.prototype.forEachReverse=function(t,e){for(var i=this.last;i;i=i.previous)t(i.object,e)},n.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var e=t.previous,i=t.next,n=t.object;for(null===i?this.last=e:i.previous=e,null===e?this.first=i:e.next=i;null!==e&&this.cmpFunc(n,e.object)<0;)e=(i=e).previous;for(;null!==i&&0<=this.cmpFunc(n,i.object);)i=(e=i).next;return null===(t.next=i)?this.last=t:i.previous=t,null===(t.previous=e)?this.first=t:e.next=t,t},e.exports=n},{}],8:[function(t,e,i){"use strict";var n=t("util").inherits,o=t("./ISound.js"),r={playAudioWhenScreenIsLocked:!1};function s(){o.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}n(s,o),(e.exports=s).prototype.setVolume=function(t){this.volume=this._audio.volume=t},s.prototype.setLoop=function(t){this.loop=this._audio.loop=t},s.prototype._load=function(){var e=this;function i(t){e._finalizeLoad(t)}function n(){this.removeEventListener("canplaythrough",n),this.removeEventListener("error",o),e.usedMemory=this.duration,e.audioManager.usedMemory+=this.duration,e._finalizeLoad(null)}function o(t){this.removeEventListener("canplaythrough",n),this.removeEventListener("error",o),i(t)}function r(t){e._loading=!0,e._audio.addEventListener("canplaythrough",n),e._audio.addEventListener("error",o),e._audio.src=t,e._audio.load()}var t=this.audioManager.settings.getFileUri,s=this.audioManager.settings.audioPath;if(2<t.length)t(s,this.id,function(t,e){if(t)return i(t);r(e)});else try{var u=t(s,this.id);if(!u)return i("emptyUri");r(u)}catch(t){i(t)}},s.prototype.unload=function(){o.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},s.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(r),this.playing=!0},s.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":6,util:3}],9:[function(t,e,i){"use strict";var n=t("util").inherits,o=t("./ISound.js"),r=1e-6;function s(){o.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}n(s,o),(e.exports=s).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,e=this.audioContext,i=e.createGain();t=e.createStereoPanner?e.createStereoPanner():e.createPanner(),i.connect(t),t.connect(e.destination),i.gain.value=0,this.sourceConnector=i,this.gain=i.gain,this.panNode=t,this._audioNodeReady=!0}},s.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,e=this.panNode,i=this.sourceConnector;i.disconnect(e),e.disconnect(t.destination),this.source&&(this.source.disconnect(i),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},s.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var e=this,i=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){e.buffer=t,e.usedMemory=t.duration,e.audioManager.usedMemory+=t.duration,e.rawAudioData=null,e._loaded&&e._playTriggered&&((e.loop||Date.now()-e._playTriggered<i)&&e._play(),e._playTriggered=0)},function(){console.error("decode audio failed for sound ",e.id)})}},s.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=r);var e=this.audioContext.currentTime;this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||r,e),this.gain.linearRampToValueAtTime(t,e+this.fade)}else this.gain.value=t},s.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},s.prototype.setLoop=function(t,e,i){this.loop=!!t,this._loopStart=e||0,this._loopEnd=i||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},s.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},s.prototype.setPitch=function(t,e){this.pitch=t,this._setPlaybackRate(e)},s.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},s.prototype._setPlaybackRate=function(t){if(this.source){var e=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var i=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(i),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||r,i),this.source.playbackRate.linearRampToValueAtTime(e,i+t)}else this.source.playbackRate.value=e}},s.prototype._load=function(){var i=this;function n(t){i._finalizeLoad(t)}function o(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i._finalizeLoad(null)}function r(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status&&0!=~~e.status?n("xhrError:"+e.status):void(i.audioContext?i.audioContext.decodeAudioData(e.response,o,n):(i.rawAudioData=e.response,i._finalizeLoad(null)))},e.open("GET",t,!0),e.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,e=this.audioManager.settings.audioPath;if(2<t.length)t(e,this.id,function(t,e){if(t)return n(t);r(e)});else try{var s=t(e,this.id);if(!s)return n("emptyUri");r(s)}catch(t){n(t)}},s.prototype.unload=function(){o.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},s.prototype._play=function(t){if(this.buffer){this.playing=!0;var e=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(e),this.fade?(this.gain.setValueAtTime(this.gain.value||r,e),this.gain.linearRampToValueAtTime(this.volume||r,e+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var i=this.source=this.audioContext.createBufferSource();i.connect(this.sourceConnector);var n=this;i.onended=function(){n.playing=!1,i.onended=null,n.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),i.loop=this.loop,i.buffer=this.buffer,this._setLoopPoints(),i.start(0)}else this._playTriggered=Date.now()},s.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},s.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var e=this,i=this.audioContext.currentTime;return this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||r,i),this.gain.linearRampToValueAtTime(r,i+this.fade),void(this._fadeTimeout=window.setTimeout(function(){e._fadeTimeout=null,e._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":6,util:3}],10:[function(t,e,i){"use strict";function n(t,e,i,n,o){this.id=t,this.soundIds=e,this.volumes=i||[],this.pitches=n||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),o||this._createSounds()}(e.exports=n).prototype._createSounds=function(){for(var t=this.soundIds,e=0;e<t.length;e++)this.audioManager.loadSound(t[e]);this._ready=!0},n.prototype.play=function(t,e,i){if(0!==this.soundIds.length){this._ready||this._createSounds();var n=this.soundIds[this.soundIndex++],o=this.audioManager.getSound(n);if(!o)return console.warn("[Sound Group: "+this.id+"] sound id "+n+"  cannot be played.");t=t||1,i=i||0,t*=this.volumes[this.volIndex++],i+=this.pitches[this.pitchIndex++],o.play(t,e,i),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},n.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var e=this.soundIds[t];this.audioManager.createSound(e)}}},{}],11:[function(t,e,i){"use strict";var s=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function n(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(e.exports=n).prototype._setRGB=function(t,e,i){this.r=t,this.g=e,this.b=i},n.prototype.fromPixel=function(t,e){var i=t[e+0],n=t[e+1],o=t[e+2];return this.string="rgb("+i+","+n+","+o+")",this._setRGB(i,n,o),this},n.prototype.fromString=function(t){var e,i,n,o=(this.string=t).match(s);if(o)e=~~o[1],i=~~o[2],n=~~o[3],this._setRGB(e,i,n);else{var r="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(r>>16,r>>8&255,255&r)}return this},n.prototype.fromRGB=function(t,e,i){return this._setRGB(t,e,i),this.string="rgb("+t+","+e+","+i+")",this},n.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],12:[function(t,e,i){"use strict";var n=t("./index"),o=t("../domUtils/createCanvas"),l=~~settings.tileSize.width,h=~~settings.tileSize.height,y=Math.PI/2;n.setTileSize=function(t,e){l=~~t,h=~~e},n.prototype._init=function(){this.canvas=o(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},n.prototype.resize=function(t,e){return this.canvas.width=this.width=t,this.canvas.height=this.height=e,this.clear(),this},n.prototype.sprite=function(t,e,i,n,o,r){var s=l*(t%16),u=h*~~(t/16),a=this.ctx;return e=e||0,i=i||0,e=~~Math.round(e-this.camera.x),i=~~Math.round(i-this.camera.y),n||o||r?(a.save(),n&&(a.scale(-1,1),e=-e-l),o&&(a.scale(1,-1),i=-i-h),r?(a.translate(e+h,i),a.rotate(y)):a.translate(e,i),a.drawImage(this.tilesheet,this.ox+s,this.oy+u,l,h,0,0,l,h),a.restore()):a.drawImage(this.tilesheet,this.ox+s,this.oy+u,l,h,e,i,l,h),this},n.prototype.draw=function(t,e,i,n,o,r){var s=n||o||r;if(t._isSprite){var u=t;t=u.img;var a=u.x,l=u.y,h=u.width,c=u.height,p=~~Math.round((e||0)-this.camera.x),f=~~Math.round((i||0)-this.camera.y);return s?((d=this.ctx).save(),r?(n&&(d.scale(-1,1),p*=-1,p-=c),o&&(d.scale(1,-1),f*=-1,f-=h),d.translate(p+c,f),d.rotate(y)):(n&&(d.scale(-1,1),p*=-1,p-=h),o&&(d.scale(1,-1),f*=-1,f-=c),d.translate(p,f)),d.drawImage(t,a,l,h,c,0,0,h,c),d.restore(),this):(this.ctx.drawImage(t,a,l,h,c,p,f,h,c),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var d;p=~~Math.round((e||0)-this.camera.x),f=~~Math.round((i||0)-this.camera.y);return s?((d=this.ctx).save(),r?(n&&(d.scale(-1,1),p*=-1,p-=t.height),o&&(d.scale(1,-1),f*=-1,f-=t.width),d.translate(p+t.height,f),d.rotate(y)):(n&&(d.scale(-1,1),p*=-1,p-=t.width),o&&(d.scale(1,-1),f*=-1,f-=t.height),d.translate(p,f)),d.drawImage(t,0,0),d.restore()):this.ctx.drawImage(t,p,f),this},n.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},n.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},n.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},n.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},n.prototype.rect=function(t,e,i,n){return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(e-this.camera.y),~~(i-1),~~(n-1)),this},n.prototype.rectf=function(t,e,i,n){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~i,~~n),this},n.prototype.rectfill=n.prototype.rectf,n.prototype._isTexture=!0,n.prototype.tilesheet=o(16*l,16*h)},{"../domUtils/createCanvas":17,"./index":13}],13:[function(t,e,i){"use strict";function n(t,e){this.width=t,this.height=e,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function o(t,e){t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite?(t.ox=e.x,t.oy=e.y,t.tilesheet=e.img):e._isMap?(e.texture||e._prepareTexture(),t.tilesheet=e.texture.canvas):e._isTexture?t.tilesheet=e.canvas:(e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}(e.exports=n).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],n.prototype.ox=0,n.prototype.oy=0,n.prototype.setPalette=function(t){n.prototype.palette=t},n.prototype.setGlobalTilesheet=function(t){o(n.prototype,t)},n.prototype.setTilesheet=function(t){if(t)return o(this,t),this;delete this.tilesheet},n.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this}},{}],14:[function(t,e,i){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=t("./index.js"),l=3,h=5,o=n.prototype.setPalette;n.prototype.setPalette=function(t){o.call(this,t),n.prototype.textCharset=new n(128*l,h*t.length),function(t,e){for(var i=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],n=0;n<e.length;n++){t.fillStyle=e[n].string;for(var o=0;o<i.length;o++)for(var r=i[o],s=0;s<15;s++){var u=s%l,a=~~(s/l);1==(r>>s&1)&&t.fillRect(o*l+u,n*h+a,1,1)}}t.fillStyle=e[0].string}(n.prototype.textCharset.ctx,t)};var s=n.prototype.resize;n.prototype.resize=function(t,e){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textPadding=e-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,s.call(this,t,e),this},n.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},n.prototype.textCharset=new n(128*l,h*n.prototype.palette.length),n.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},n.prototype.print=function(e,t,i){if("object"===r(e))try{e=JSON.stringify(e)}catch(t){e="[Object]"}else"string"!=typeof e&&(e=e.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),i=~~Math.round(i-this.camera.y);for(var n=0;n<e.length;n++)this.ctx.drawImage(this.textCharset.canvas,l*e.charCodeAt(n),h*this._pen,l,h,t,i,l,h),t+=4;return this}for(n=0;n<e.length;n++){this._cursor.j>=this._textLine&&this.textScroll();var o=e.charCodeAt(n);10!==o&&13!==o?(this.ctx.drawImage(this.textCharset.canvas,l*o,h*this._pen,l,h,4*this._cursor.i,6*this._cursor.j+this._textOffset,l,h),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},n.prototype.println=function(t){return this.print(t),this.print("\n"),this},n.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":13}],15:[function(t,e,i){"use strict";var n=t("../Texture"),l=~~settings.tileSize.width,h=~~settings.tileSize.height;function c(t,e,i,n,o,r,s,u){this.x=~~t,this.y=~~e,this.sprite=~~i,this.flipH=!!n,this.flipV=!!o,this.flipR=!!r,this.flagA=!!s,this.flagB=!!u}function r(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}(e.exports=r).prototype._isTileMap=!0;var u,f,o={},s=[];r.getMap=function(t){return"string"==typeof t?o[t]:"number"==typeof t?s[t]:(console.error("Map does not exist",t),null)},r._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},r.loadBank=function(t){t=r._checkBankFormat(t),o={},s=[];for(var e=t.maps||[],i=0;i<e.length;i++)s.push((new r).load(e[i]))},r.setTileSize=function(t,e){l=~~t,h=~~e},Object.defineProperty(r.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&o[this._name]&&o[this._name]===this&&delete o[this._name],(this._name=t)&&!o[t]&&(o[t]=this)}}),r.prototype._init=function(t,e){this.width=t,this.height=e,this.items=[];for(var i=0;i<t;i++){this.items.push([]);for(var n=0;n<e;n++)this.items[i][n]=null}this.texture&&this.texture.resize(t*l,e*h)},r.prototype.resize=function(t,e){var i=this.items,n=Math.min(this.width,t),o=Math.min(this.height,e);this._init(t,e);for(var r=0;r<n;r++)for(var s=0;s<o;s++)this.items[r][s]=i[r][s];return this.redraw(),this},r.prototype.set=function(t,e,i,n,o,r,s,u){if(null==i)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var a=this.items[t][e]=new c(t,e,i,n,o,r,s,u);return this.texture&&(this.texture.ctx.clearRect(t*l,e*h,l,h),this.texture.sprite(a.sprite,a.x*l,a.y*h,a.flipH,a.flipV,a.flipR)),this}},r.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture&&this.texture.ctx.clearRect(t*l,e*h,l,h),this},r.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},r.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var i=this.items[t][e];i&&this.texture.sprite(i.sprite,i.x*l,i.y*h,i.flipH,i.flipV,i.flipR)}return this},r.prototype._prepareTexture=function(){this.texture=new n(this.width*l,this.height*h),this.texture.setTilesheet(this.tilesheet),this.redraw()},r.prototype.release=function(){this.texture=null},r.prototype.draw=function(t,e){this.texture||this._prepareTexture(),draw(this.texture,t,e)},r.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&this.texture.setTilesheet(t),this.redraw(),this},r.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var e=t.split("/"),i=window.assets||{},n=0;n<e.length;n++)if(!(i=i[e[n]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(i)},function(){for(var i="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",l={},t=0;t<i.length;t++)l[i[t]]=t;var h=i.length,c=h*h-1,p=Math.pow(2,13),r=c-p-1;function s(t){var e=t%h;return i[~~(t/h)]+i[e]}u=function(t){for(var e="",i=0,n=0;n<t.length;n++){var o=t[n];o===t[n+1]&&++i<r||(null===o&&(o=c),e+=s(o),i===r&&i--,0!==i&&(e+=s(p+i)),i=0)}return i===r&&i--,0!==i&&(e+=s(p+i)),e},f=function(t){for(var e=[],i=0;i<t.length;){var n=t[i++],o=t[i++],r=l[n]*h+l[o];if(r===c)e.push(null);else if(p<r)for(var s=r-p,u=e[e.length-1],a=0;a<s;a++)e.push(u);else e.push(r)}return e}}(),r.prototype.save=function(){for(var t=this.width,e=this.height,i=new Array(t*e),n=0;n<t;n++)for(var o=0;o<e;o++){var r=this.items[n][o];i[n+o*t]=r?r.sprite+(r.flipH<<8)+(r.flipV<<9)+(r.flipR<<10)+(r.flagA<<11)+(r.flagB<<12):null}return{w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:u(i)}},r.prototype.load=function(t){this.texture=null;var e=t.w,i=t.h;this._init(e,i),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var n=f(t.data),o=0;o<e;o++)for(var r=0;r<i;r++){var s=n[o+r*e];if(null!==s){var u=255&s,a=s>>8&1,l=s>>9&1,h=s>>10&1,c=s>>11&1,p=s>>12&1;this.set(o,r,u,a,l,h,c,p)}}return this},r.prototype.copy=function(t,e,i,n){t=t||0,e=e||0,null==i&&(i=this.width),null==n&&(n=this.height);var o=new r(i,n);return o.paste(this,-t,-e),o},r.prototype.paste=function(t,e,i,n){e=e||0,i=i||0;for(var o=Math.min(t.width,this.width-e),r=Math.min(t.height,this.height-i),s=Math.max(0,-e),u=Math.max(0,-i),a=s;a<o;a++)for(var l=u;l<r;l++){var h=t.items[a][l];if(h)this.set(a+e,l+i,h.sprite,h.flipH,h.flipV,h.flipR,h.flagA,h.flagB);else{if(n)continue;this.remove(a+e,l+i)}}return this},r.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture&&this.texture.clear(),this},r.prototype.find=function(t,e,i){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===i&&(i=null);for(var n=[],o=0;o<this.width;o++)for(var r=0;r<this.height;r++){var s=this.items[o][r];if(s){var u=null===e||s.flagA===e,a=null===i||s.flagB===i;s.sprite===t&&u&&a&&n.push(s)}}return n},r.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)null===this.items[e][i]&&t.push({x:e,y:i});return t}},{"../Texture":13}],16:[function(t,e,i){"use strict";function f(t,e){var i=new Image;i.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},i.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},i.src=t}function d(t,e){var i=new Audio;function n(){e&&e(null,i),i.removeEventListener("canplaythrough",n),i.removeEventListener("error",o)}function o(){e&&e("snd:load"),i.removeEventListener("canplaythrough",n),i.removeEventListener("error",o)}i.preload=!0,i.loop=!1,i.addEventListener("canplaythrough",n),i.addEventListener("error",o),i.src=t,i.load()}i.loadData=function(t,e,i){var n=new XMLHttpRequest;n.responseType=e||"arraybuffer",n.onreadystatechange=function(){if(4==~~n.readyState)return 200!=~~n.status&&0!=~~n.status?i&&i("xhrError:"+n.status):i&&i(null,n.response)},n.open("GET",t,!0),n.send()},i.loadJson=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status?e("xhrError:"+i.status):e&&e(null,JSON.parse(i.response))},i.open("GET",t,!0),i.send()},i.loadImage=f,i.loadSound=d,i.preloadStaticAssets=function(n,o,r){var u=n.dat,s=n.img.length,a=s+n.snd.length,l=n.root,h=0,c=0;function p(){var i,t,e=h+c;r&&r(h,e,a,e/a),t=e<s?(i=n.img[e],f):(i=n.snd[e-s],d),c+=1,t(l+i,function(t,e){t||function(t,e){var i=t.split("/"),n=i.pop().split(".");n.pop(),n=n.join(".");for(var o=u,r=0,s=i.length;r<s;r++)o=o[i[r]];o[n]=e,i.push(n),e.name=n,e.path=i.join("/")}(i,e),(h+=1)+--c<a?p():0===c&&o(null,u)})}if(0===a)return o(null,u);for(var t=Math.min(5,a-1),e=0;e<=t;e++)p()}},{}],17:[function(t,e,i){"use strict";e.exports=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}},{}],18:[function(t,e,i){"use strict";var c=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],n=!(!navigator||!navigator.getGamepads),p=!1,f=.2;function o(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}o.prototype._setupButtons=function(){for(var t=0;t<c.length;t++){var e=c[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var d=[new o,new o,new o,new o,window],r=new o;var s=n?function(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var i=t[e],n=d[e];if(i){var o,r,s,u;n.available=!0,p&&(o=n.btn.right,r=n.btn.left,u=n.btn.down,s=n.btn.up);for(var a=0;a<c.length;a++){var l=c[a],h=i.buttons[a].pressed;n.btnp[l]=!n.btn[l]&&h,n.btnr[l]=n.btn[l]&&!h,n.btn[l]=h}n.x=i.axes[0],n.y=i.axes[1],n.z=i.axes[2],n.w=i.axes[3],n.lt=i.buttons[6].value,n.rt=i.buttons[7].value,p&&(n.btn.right=n.btn.right||n.x>f,n.btn.left=n.btn.left||n.x<-f,n.btn.down=n.btn.down||n.y>f,n.btn.up=n.btn.up||n.y<-f,n.btnp.right=n.btn.right&&!o,n.btnp.left=n.btn.left&&!r,n.btnp.down=n.btn.down&&!u,n.btnp.up=n.btn.up&&!s,n.btnr.right=!n.btn.right&&o,n.btnr.left=!n.btn.left&&r,n.btnr.down=!n.btn.down&&u,n.btnr.up=!n.btn.up&&s)}else n.available=!1}return d}:function(){return d};i.mapAnalogStickToDpad=function(t){p=!0,f=void 0===t?.3:t},i.update=function(){window.gamepads=s(),window.gamepad=function(){for(var t=0;t<c.length;t++){var e=c[t];r.btnp[e]=btnp[e]||d[0].btnp[e]||d[1].btnp[e]||d[2].btnp[e]||d[3].btnp[e],r.btnr[e]=btnr[e]||d[0].btnr[e]||d[1].btnr[e]||d[2].btnr[e]||d[3].btnr[e],r.btn[e]=btn[e]||d[0].btn[e]||d[1].btn[e]||d[2].btn[e]||d[3].btn[e]}return r.btn.up&&r.btn.down&&(r.btn.down=!1),r.btn.right&&r.btn.left&&(r.btn.left=!1),r}()}},{}],19:[function(t,e,i){"use strict";e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],20:[function(t,e,i){e.exports={dat:{palette:null,"tilesheet-old":null,tilesheet:null,maps:{_type:"maps",maps:[{w:16,h:16,name:"map",sheet:"",data:"!!.q"}]},".atlas":{0:null,data:{_type:"spritesheets",spritesheets:{gui:{_type:"spritesheet",_meta:{image:"0",defaultWidth:24,defaultHeight:22},hotbar:{x:0,y:0,w:77},hotbarSelection:{x:77,y:0,h:24}}}}},itemIcons:{bomb:null,pickaxe:null,supernova:null}},root:"assets/",img:["palette.png","tilesheet-old.png","tilesheet.png",".atlas/0.png","itemIcons/bomb.png","itemIcons/pickaxe.png","itemIcons/supernova.png"],snd:[],settings:{name:"InfiniteScrollTest",version:"2.0.0",appid:"tS5rOaCO0q7DTvXC",screen:{fullscreen:!1,resizable:!1,keepAspectRatio:!1,width:250,height:250,pixelSize:{width:2,height:2}},tileSize:{width:16,height:16},palette:{name:"pico8",file:"palette",colors:["#000000","#FFF1E8","#008751","#AB5236","#7E2553","#5F574F","#29ADFF","#00E756","#FFA300","#FF77A8","#C2C3C7","#83769C","#FFFF27","#FFCCAA","#1D2B53","#FF004D"]},controls:{up:38,down:40,left:37,right:39,A:90,B:88,one:49,two:50,three:51,four:52},touchEvent:{multiTouch:!1,disableContextMenu:!0,hideMousePointer:!1},gamepad:{analogToDpad:!0,deadZone:.5},loader:{colors:["#140C1C","#DEEED6"],custom:""}}}},{}],21:[function(t,e,i){"use strict";function n(t,e,i,n,o,r,s,u){this.img=t,this.path=e,this.x=i,this.y=n,this.width=o,this.height=r,this.pivotX=s||0,this.pivotY=u||0}n.prototype._isSprite=!0,e.exports=n},{}],22:[function(t,e,i){"use strict";var d=t("./Sprite");function y(t,e){return t?t+"/"+e:e}function h(t,e,i,n,o,r){var s=new d(o,e,i.x,i.y,i.w||r.defaultWidth,i.h||r.defaultHeight,i.p||r.defaultPivotX,i.q||r.defaultPivotY);t[n]=s}function c(t,e,i,n,o,r){t[n]||(t[n]={});var s=t[n];for(var u in i)if("_folder"!==u){var a=i[u],l=y(e,u);(a._folder?c:h)(s,l,a,u,o,r)}}function a(t,e,i,n){var o=i._meta;o.grid?function(t,e,i,n){for(var o=n.width,r=n.height,s=i.spriteWidth,u=i.spriteHeight,a=i.list,l=0,h=0;h<r;h+=u)for(var c=0;c<o;c+=s){if(l>=a.length)return;var p=a[l],f=new d(n,y(e,p),c,h,s,u);t[p]=f,l++}}(t,e,o,n):function(t,e,i,n,o){for(var r in i)if("_type"!==r&&"_meta"!==r){var s=i[r],u=y(e,r);(s._folder?c:h)(t,u,s,r,n,o)}}(t,e,i,n,o)}i.unpackSpritesheets=function(){var t=assets[".atlas"];if(t&&t.data){var e=t.data.spritesheets;for(var i in e){for(var n=e[i],o=t[n._meta.image],r=i.split("/"),s=window.assets;r.length;){var u=r.shift();""!==u&&(s[u]||(s[u]={}),s=s[u])}a(s,i,n,o)}}}},{"./Sprite":21}],23:[function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o,r;r=function(){function i(t){this._value=NaN,this._seed="string"==typeof t?this.hashCode(t):"number"==typeof t?this.getSafeSeed(t):this.getSafeSeed(i.MIN+Math.floor((i.MAX-i.MIN)*Math.random())),this.reset()}return i.prototype.next=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.recalculate(),this.map(this._value,i.MIN,i.MAX,t,e)},i.prototype.nextInt=function(t,e){return void 0===t&&(t=10),void 0===e&&(e=100),this.recalculate(),Math.floor(this.map(this._value,i.MIN,i.MAX,t,e+1))},i.prototype.nextString=function(t,e){void 0===t&&(t=16),void 0===e&&(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var i="";i.length<t;)i+=this.nextChar(e);return i},i.prototype.nextChar=function(t){return void 0===t&&(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),this.recalculate(),t.substr(this.nextInt(0,t.length-1),1)},i.prototype.nextArrayItem=function(t){return this.recalculate(),t[this.nextInt(0,t.length-1)]},i.prototype.nextBoolean=function(){return this.recalculate(),.5<this._value},i.prototype.skip=function(t){for(void 0===t&&(t=1);0<t--;)this.recalculate()},i.prototype.reset=function(){this._value=this._seed},i.prototype.recalculate=function(){this._value=this.xorshift(this._value)},i.prototype.xorshift=function(t){return t^=t<<13,t^=t>>17,t^=t<<5},i.prototype.map=function(t,e,i,n,o){return(t-e)/(i-e)*(o-n)+n},i.prototype.hashCode=function(t){var e=0;if(t)for(var i=t.length,n=0;n<i;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0,e=this.xorshift(e);return this.getSafeSeed(e)},i.prototype.getSafeSeed=function(t){return 0===t?1:t},i.MIN=-2147483648,i.MAX=2147483647,i},"object"===((o=void 0)===i?"undefined":n(i))&&void 0!==e?e.exports=r():"function"==typeof define&&define.amd?define(r):(o=o||self).Prando=r(),e.exports.default=e.exports},{}],24:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o=function(){function r(t,e,i,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.game=t,this.visible=!0,this.startT=this.game.t,this.x=e,this.y=i,this.h=o,this.w=n,this.xv=0,this.yv=0,this.oldXv=0,this.oldYv=0,this.xFriction=1,this.yFriction=1,this.bounce=0,this.collideWithSolid=!0,this.spriteOffsetX=0,this.spriteOFfsetY=0}var t,e,i;return t=r,(e=[{key:"centerX",value:function(){return Math.round(this.x+this.w/2)}},{key:"centerY",value:function(){return Math.round(this.y-this.h/2)}},{key:"left",value:function(){return Math.round(this.x)}},{key:"right",value:function(){return Math.round(this.x)+this.w-1}},{key:"top",value:function(){return Math.round(this.y)-this.h+1}},{key:"bottom",value:function(){return Math.round(this.y)}},{key:"onGround",value:function(){return this.game.map.getSolidAtPixel(this.left()+3,this.bottom()+1)}},{key:"getSprite",value:function(){return 0}},{key:"doBehaviour",value:function(){}},{key:"collided",value:function(){}},{key:"update",value:function(){this.doBehaviour(),this.doPhysics(),this.xo=this.xv,this.yo=this.yv,this.collideWithSolid&&this.collideWithMap(),this.updatePosition(),this.oldXv=this.xv,this.oldYv=this.yv}},{key:"doPhysics",value:function(){this.falls&&(this.yv+=.1),this.xv=this.xv*this.xFriction,this.yv=this.yv*this.yFriction,this.onGround()&&.5<this.lastYv&&(this.yv=-1*this.lastYv*this.bounce),this.lastYv=this.yv,Math.abs(this.xv)<.01&&(this.xv=0,this.x=Math.round(this.x)),Math.abs(this.yv)<.01&&(this.yv=0,this.y=Math.round(this.y))}},{key:"collideWithMap",value:function(){if(0!==this.yv)for(var t=0<this.yv?1:-1,e=0<this.yv?this.bottom():this.top(),i=this.game.map.getMapCoordAtPixel(0,e).y,n=this.game.map.getMapCoordAtPixel(this.left(),0).x,o=this.game.map.getMapCoordAtPixel(this.right(),0).x,r=n;r<o+1;r++)for(var s=i;1==t?s<i+3:i-3<s;s+=t)if(0<this.game.map.getTileAtCoord(r,s)){0<this.yv?this.yo=Math.min(this.yo,s*this.game.map.tilesize-e-t):this.yo=Math.max(this.yo,s*this.game.map.tilesize+this.game.map.tilesize-e);break}if(0!==(window.player=this).xv)for(var u=0<this.xv?1:-1,a=0<this.xv?this.right():this.left(),l=this.game.map.getMapCoordAtPixel(a,0).x+u,h=this.game.map.getMapCoordAtPixel(0,this.top()).y,c=this.game.map.getMapCoordAtPixel(0,this.bottom()).y,p=h;p<c+1;p++)for(var f=l;1==u?f<l+3:l-3<f;f+=u)if(0<this.game.map.getTileAtCoord(f,p)){0<this.xv?this.xo=Math.min(this.xo,f*this.game.map.tilesize-a-1):this.xo=Math.max(this.xo,f*this.game.map.tilesize+this.game.map.tilesize-a);break}}},{key:"updatePosition",value:function(){this.xv=this.xo,this.yv=this.yo,0===this.xo&&this.collided(),this.x+=this.xo,this.y+=this.yo}},{key:"kill",value:function(){this.game.removeEntity(this)}},{key:"fastDistanceTo",value:function(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)}},{key:"aliveTime",get:function(){return this.game.t-this.startT}}])&&n(t.prototype,e),i&&n(t,i),r}();i.default=o},{}],25:[function(t,e,i){"use strict";function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=function(){function n(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.player=t,this.game=t.game,this.id=e,this.displayName=i}var t,e,i;return t=n,(e=[{key:"use",value:function(){console.log("Not implemented")}}])&&o(t.prototype,e),i&&o(t,i),n}();i.default=n},{}],26:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,o=(n=t("./generators/EvilScienceGenerator"))&&n.__esModule?n:{default:n};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tilesize=16,this.w=64,this.h=128,this.generator=new o.default(this.w,this.h),this.tiles=this.generator.generateTiles()}var e,i,n;return e=t,(i=[{key:"getTileAtCoord",value:function(t,e){return this.tiles[e*this.w+t]}},{key:"setTileAtCoord",value:function(t,e,i){e<0||t<0||t>this.w||e<0||t<0||t>this.w||e>this.h||(this.tiles[e*this.w+t]=i)}},{key:"setTileAtPixel",value:function(t,e,i){var n=this.getMapCoordAtPixel(t,e);this.setTileAtCoord(n.x,n.y,i)}},{key:"getMapCoordAtPixel",value:function(t,e){return{x:Math.floor(Math.round(t)/this.tilesize),y:Math.floor(Math.round(e)/this.tilesize)}}},{key:"getTileAtPixel",value:function(t,e){var i=this.getMapCoordAtPixel(t,e);return this.getTileAtCoord(i.x,i.y)}},{key:"getSolidAtPixel",value:function(t,e){return this.isTileIdSolid(this.getTileAtPixel(t,e))}},{key:"isTileIdSolid",value:function(t){return 0<t}}])&&r(e.prototype,i),n&&r(e,n),t}();i.default=s},{"./generators/EvilScienceGenerator":29}],27:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,o=(n=t("./Entity"))&&n.__esModule?n:{default:n};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(r){return function(){var t,e,i,n=u(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=u(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==s(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(u,o["default"]);var t,e,i,s=l(u);function u(t,e,i,n,o){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(r=s.call(this,t,e,i,n,o)).collideWithSolid=!1,r.falls=!1,r.lifetime=240,r.spriteOffsetX=-r.w/2,r.spriteOffsetY=-r.h/2,r}return t=u,(e=[{key:"doBehaviour",value:function(){this.aliveTime>=this.lifetime&&this.kill()}}])&&r(t.prototype,e),i&&r(t,i),u}();i.default=h},{"./Entity":24}],28:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=o(t("./Entity")),s=o(t("./items/Pickaxe")),u=o(t("./items/Bomb")),a=o(t("./items/Supernova"));function o(t){return t&&t.__esModule?t:{default:t}}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(r){return function(){var t,e,i,n=d(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=d(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==l(i)&&"function"!=typeof i?f(e):i}}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(r,n["default"]);var t,e,i,o=p(r);function r(t,e,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=o.call(this,t,e,i,9,14)).xa=0,n.ya=0,n.falls=!0,n.facing="d",n.xFriction=.9,n.spriteOffsetX=-4,n.spriteOFfsetY=-15,n.hotbarSelectedIndex=0,n.hotbarItems=[new s.default(f(n)),new u.default(f(n)),new a.default(f(n))],n}return t=r,(e=[{key:"getSprite",value:function(){switch(this.facing){case"l":return 18;case"r":return 19;case"u":return 17;case"d":default:return 16}}},{key:"doInputs",value:function(){btn.down&&(this.facing="d"),btn.left&&(this.xa=-.1,this.facing="l"),btn.right&&(this.xa=.1,this.facing="r"),btnp.up&&(this.onGround()&&(this.yv=-4),this.facing="u"),btn.left||btn.right||(this.xa=0),btnp.one&&(this.hotbarSelectedIndex=0),btnp.two&&(this.hotbarSelectedIndex=1),btnp.three&&(this.hotbarSelectedIndex=2),btnp.four&&(this.hotbarSelectedIndex=3),!btnp.A||this.hotbarItems[this.hotbarSelectedIndex]&&this.hotbarItems[this.hotbarSelectedIndex].use()}},{key:"doBehaviour",value:function(){this.doInputs(),this.xv=clamp(this.xv+this.xa,-1,1),this.yv=clamp(this.yv,-4,4),this.xv=clamp(this.xv,-4,4)}}])&&h(t.prototype,e),i&&h(t,i),r}();i.default=r},{"./Entity":24,"./items/Bomb":30,"./items/Pickaxe":31,"./items/Supernova":32}],29:[function(t,e,i){"use strict";function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.w=t,this.h=e,this.tiles=new Uint8Array(t*e)}var t,e,n;return t=i,(e=[{key:"generateTiles",value:function(){this.tiles.fill(0);for(var t=0;t<this.h;t++)for(var e=0;e<this.w;e++)100*Math.random()<72&&this.setTile(e,t,1);for(var i=0;i<1e3;i++){var n=Math.round(Math.random()*this.w),o=Math.round(Math.random()*this.w);this.setTile(n,o,4<this.getSolidNeighboursCount(n,o)?1:0)}for(var r=0;r<1;r++)for(var s=0;s<this.h;s++)for(var u=0;u<this.w;u++)this.getSolidNeighboursCount(u,s)<4&&this.setTile(u,s,0);for(var a=0;a<this.h;a++)for(var l=0;l<this.w;l++)0===this.getTile(l,a)&&4<this.getSolidNeighboursCount(l,a)&&this.setTile(l,a,1);for(var h=0;h<this.w;h++)for(var c=0;c<20;c++)if(0<this.getTile(h,c)){this.setTile(h,c,5),this.setTile(h,c+1,2),this.setTile(h,c+2,2);break}return this.tiles}},{key:"getTile",value:function(t,e){return this.tiles[e*this.w+t]}},{key:"setTile",value:function(t,e,i){this.tiles[e*this.w+t]=i}},{key:"getEmptyNeighboursCount",value:function(t,e){return 8-this.getSolidNeighboursCount(t,e)}},{key:"getSolidNeighboursCount",value:function(t,e){var i=0;return 0<this.getTile(t-1,e-1)&&i++,0<this.getTile(t,e-1)&&i++,0<this.getTile(t+1,e-1)&&i++,0<this.getTile(t-1,e)&&i++,0<this.getTile(t+1,e)&&i++,0<this.getTile(t-1,e+1)&&i++,0<this.getTile(t,e+1)&&i++,0<this.getTile(t+1,e+1)&&i++,i}}])&&o(t.prototype,e),n&&o(t,n),i}();i.default=n},{}],30:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=n(t("../Item")),s=n(t("../mobs/BombEntity"));function n(t){return t&&t.__esModule?t:{default:t}}function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(r){return function(){var t,e,i,n=c(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=c(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==u(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(o,r["default"]);var t,e,i,n=h(o);function o(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),n.call(this,t,"bomb","Bomb")}return t=o,(e=[{key:"use",value:function(){var t;console.log("Use bomb"),t="l"===this.player.facing?this.player.xv+-.5:this.player.xv+.5,t*=.5+Math.random()/2;var e=new s.default(this.player.game,this.player.centerX(),this.player.centerY()-3.5);e.xv=t,e.yv=-1,this.game.spawnEntity(e)}}])&&a(t.prototype,e),i&&a(t,i),o}();i.default=o},{"../Item":25,"../mobs/BombEntity":34}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,r=(n=t("../Item"))&&n.__esModule?n:{default:n};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(r){return function(){var t,e,i,n=h(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=h(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==s(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(o,r["default"]);var t,e,i,n=l(o);function o(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),n.call(this,t,"pickaxe","Pickaxe")}return t=o,(e=[{key:"use",value:function(){var t,e;switch(this.player.facing){case"l":t=this.player.left()-1,e=this.player.centerY();break;case"r":t=this.player.right()+1,e=this.player.centerY();break;case"u":t=this.player.centerX(),e=this.player.bottom()-this.game.map.tilesize-3;break;default:t=this.player.centerX(),e=this.player.bottom()+1}this.game.map.setTileAtPixel(t,e,0)}}])&&u(t.prototype,e),i&&u(t,i),o}();i.default=o},{"../Item":25}],32:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=n(t("../Item")),s=n(t("../mobs/Missile"));function n(t){return t&&t.__esModule?t:{default:t}}function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(r){return function(){var t,e,i,n=c(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=c(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==u(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(o,r["default"]);var t,e,i,n=h(o);function o(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),n.call(this,t,"supernova","Supernova")}return t=o,(e=[{key:"use",value:function(){var t;console.log("Use supernova"),t="l"===this.player.facing?this.player.xv+-1:this.player.xv+1,t*=5;var e=new s.default(this.player.game,this.player.centerX(),this.player.centerY()-3.5);e.xv=t,e.yv=0,this.game.spawnEntity(e)}}])&&a(t.prototype,e),i&&a(t,i),o}();i.default=o},{"../Item":25,"../mobs/Missile":36}],33:[function(t,e,i){"use strict";s(t("prando"));var n=s(t("./Player")),o=s(t("./Map")),r=s(t("./mobs/MiniKupa"));function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map=new o.default,this.entities=[],this.t=0}var e,i,n;return e=t,(i=[{key:"spawnEntity",value:function(t){return this.entities.push(t),t}},{key:"removeEntity",value:function(t){var e=this.entities.indexOf(t);-1<e&&this.entities.splice(e,1)}}])&&u(e.prototype,i),n&&u(e,n),t}());(window.game=a).player=a.spawnEntity(new n.default(a,a.map.w*a.map.tilesize/2,-10)),a.spawnEntity(new r.default(a,100,-10));var l={x:8,y:0},h={x:0,y:-64};i.update=function(){a.t++,a.entities.forEach(function(t){return t.update()}),l.x=a.player.x,l.y=a.player.y,h.y=Math.max(0,a.player.y)-64,h.y=a.player.y-150,h.x=a.player.x-200,function(){paper(12),cls(),camera(h.x,h.y);for(var t=0;t<a.map.h;t++)for(var e=0;e<a.map.w;e++){var i=a.map.getTileAtCoord(e,t);0<i&&sprite(i-1,e*a.map.tilesize,t*a.map.tilesize)}paper(14),rectfill(l.x+1,l.y,2,1),rectfill(l.x-2,l.y,2,1),rectfill(l.x,l.y+1,1,2),rectfill(l.x,l.y-2,1,2),a.entities.forEach(function(t){t.visible&&sprite(t.getSprite(),Math.round(t.x+t.spriteOffsetX),Math.round(t.y+t.spriteOFfsetY))}),camera(0,0),print("tile at foot: 42",2,2),function(){draw(assets.gui.hotbar,86.5,224);for(var t=0;t<a.player.hotbarItems.length;t++)draw(assets.itemIcons[a.player.hotbarItems[t].id],89.5+18*t,227);draw(assets.gui.hotbarSelection,85.5+18*a.player.hotbarSelectedIndex,223)}()}()}},{"./Map":26,"./Player":28,"./mobs/MiniKupa":35,prando:23}],34:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=o(t("../Entity")),c=o(t("../particles/Smoke"));function o(t){return t&&t.__esModule?t:{default:t}}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(r){return function(){var t,e,i,n=h(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=h(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==s(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(r,n["default"]);var t,e,i,o=l(r);function r(t,e,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=o.call(this,t,e,i,7,8)).falls=!0,n.spriteOffsetX=0,n.spriteOFfsetY=-15,n.bounce=.4,n.xv=2,n.yv=-.3,n.xFriction=.99,n.state="waiting",n.blastRadius=44,n}return t=r,(e=[{key:"doBehaviour",value:function(){200<this.aliveTime&&"waiting"===this.state&&(this.state="goingToExplode"),"goingToExplode"===this.state&&(this.visible=4<this.aliveTime%8),300<this.aliveTime&&"goingToExplode"===this.state&&(this.state="exploded",this.destroyTiles(),this.visible=!1,this.kill())}},{key:"destroyTiles",value:function(){for(var t,e,i=this.centerX()-this.blastRadius,n=this.centerX()+this.blastRadius,o=this.centerY()-this.blastRadius,r=this.centerY()+this.blastRadius,s=this.game.map.getMapCoordAtPixel(i,o),u=this.game.map.getMapCoordAtPixel(n,r),a=this.blastRadius*this.blastRadius,l=s.y;l<u.y+1;l++)for(var h=s.x;h<u.x+1;h++)t=h*this.game.map.tilesize+this.game.map.tilesize/2,e=l*this.game.map.tilesize+this.game.map.tilesize/2,Math.pow(Math.abs(t-this.centerX()),2)+Math.pow(Math.abs(e-this.centerY()),2)<=a&&(this.game.map.setTileAtCoord(h,l,0),this.game.spawnEntity(new c.default(this.game,h*this.game.map.tilesize+this.game.map.tilesize/2,l*this.game.map.tilesize+this.game.map.tilesize/2)))}},{key:"getSprite",value:function(){return 32}}])&&u(t.prototype,e),i&&u(t,i),r}();i.default=r},{"../Entity":24,"../particles/Smoke":37}],35:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,s=(n=t("../Entity"))&&n.__esModule?n:{default:n};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(r){return function(){var t,e,i,n=c(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=c(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==u(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(r,s["default"]);var t,e,i,o=h(r);function r(t,e,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=o.call(this,t,e,i,14,8)).falls=!0,n.spriteOffsetX=0,n.spriteOFfsetY=-15,n.speed=.5,n.xv=-n.speed,n}return t=r,(e=[{key:"doBehaviour",value:function(){this.xv<0&&this.game.map.getSolidAtPixel(this.left()-1,this.y-3)&&(this.xv=this.speed),0<this.xv&&this.game.map.getSolidAtPixel(this.right()+1,this.y-3)&&(this.xv=-this.speed)}},{key:"getSprite",value:function(){return 49}}])&&a(t.prototype,e),i&&a(t,i),r}();i.default=o},{"../Entity":24}],36:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;o(t("../Entity"));var n=o(t("../particles/Smoke")),s=o(t("./BombEntity"));function o(t){return t&&t.__esModule?t:{default:t}}function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(r){return function(){var t,e,i,n=c(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=c(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==u(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var r=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(r,s["default"]);var t,e,i,o=h(r);function r(t,e,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=o.call(this,t,e,i,7,8)).falls=!0,n.blastRadius=50,n}return t=r,(e=[{key:"doBehaviour",value:function(){this.aliveTime%4==0&&this.game.spawnEntity(new n.default(this.game,this.x+4,this.y-10))}},{key:"collided",value:function(){this.state="exploded",this.destroyTiles(),this.visible=!1,this.kill()}},{key:"getSprite",value:function(){return 33}}])&&a(t.prototype,e),i&&a(t,i),r}();i.default=r},{"../Entity":24,"../particles/Smoke":37,"./BombEntity":34}],37:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,s=(n=t("../Particle"))&&n.__esModule?n:{default:n};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(r){return function(){var t,e,i,n=c(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var o=c(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!==u(i)&&"function"!=typeof i?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):i}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var o=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(r,s["default"]);var t,e,i,o=h(r);function r(t,e,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=o.call(this,t,e,i,16,16)).animationSprites=[80,81,82,83],n.currentSpriteIndex=0,n.lifetime=100,n}return t=r,(e=[{key:"getSprite",value:function(){return this.currentSpriteIndex=Math.min(this.animationSprites.length,Math.floor(this.aliveTime/4)),this.animationSprites[this.currentSpriteIndex]}}])&&a(t.prototype,e),i&&a(t,i),r}();i.default=o},{"../Particle":27}],38:[function(d,t,e){"use strict";var i=d("./projectData.json");window.settings=i.settings;var n,o,r=d("./assetLoader");function s(){n.resume(),document.body.removeEventListener("mousedown",s),document.body.removeEventListener("touchstart",s)}window.inherits=d("./inherits"),window.setFullScreen=function(){},n=null,o=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return n||(n=new o,document.body.addEventListener("mousedown",s),document.body.addEventListener("touchstart",s),n)};var u=d("audio-manager"),a=window.audioManager=new u(["sfx"]);a.settings.audioPath="audio/",a.settings.defaultFade=.3,a.init(),a.setVolume("sfx",1),window.sfx=function(t,e,i,n){a.playSound("sfx",t,e,i,n)},window.music=function(t,e,i,n){t?a.playLoopSound("sfx",t,e,0,0,i,n):a.stopLoopSound("sfx")};var l=window.btn={},h=window.btnp={},c=window.btnr={},p={},f=[],y=0;function v(){for(var t=0;t<y;t++)h[f[t]]=!1,c[f[t]]=!1}function m(t,e){var i=p[t];i&&(e&&!l[i]&&(h[i]=!0),!e&&l[i]&&(c[i]=!0),l[i]=e)}!function(){var t=settings.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t)p[t[e]]=e,l[e]=!1,h[e]=!1,c[e]=!1,f.push(e);y=f.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||m(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),m(t.keyCode,!1)}),window.chr$=function(t){return String.fromCharCode(t)},window.clamp=function(t,e,i){return Math.max(e,Math.min(i,t))},window.random=function(t,e){return void 0===e?~~(t*Math.random()):~~(t+Math.random()*(e-t))};var g=d("./Texture"),b=d("./TileMap");d("./Texture/canvas2D"),d("./Texture/textCanvas2D"),window.texture=function(t){var e=new g(t.width,t.height);return e.clear().draw(t,0,0),e},window.tilesheet=function(t){return g.prototype.setGlobalTilesheet(t)};var x=function(){var t=settings.screen,a=t.width,l=t.height,h=t.pixelSize,e=window.$screen=new g(a,l),i=e.canvas,n=i.style;if(document.body.appendChild(i),t.fullscreen)if(t.keepAspectRatio){var o=function(){var t=window.innerWidth,e=window.innerHeight,i=a*h.width,n=l*h.height,o=Math.min(t/i,e/n),r=i*o,s=n*o,u=$screen.canvas.style;u.width=r+"px",u.height=s+"px",u.left=(t-r)/2+"px",u.top=(e-s)/2+"px"};addEventListener("resize",o),o()}else n.width=n.height="100%";else n.width=a*h.width+"px",n.height=l*h.height+"px";return e}();window.cls=function(){return x.cls()},window.sprite=function(t,e,i,n,o,r){return x.sprite(t,e,i,n,o,r)},window.draw=function(t,e,i,n,o,r){return x.draw(t,e,i,n,o,r)},window.rect=function(t,e,i,n){return x.rect(t,e,i,n)},window.rectf=function(t,e,i,n){return x.rectf(t,e,i,n)},window.camera=function(t,e){return x.setCamera(t,e)},window.pen=function(t){return x.pen(t)},window.paper=function(t){return x.paper(t)},window.locate=function(t,e){return x.locate(t,e)},window.print=function(t,e,i){return x.print(t,e,i)},window.println=function(t){return x.println(t)},window.getMap=b.getMap,window.rectfill=window.rectf,x.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var w=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var _=~~(settings.screen.width/2),S=~~(settings.screen.width/4),M=~~(settings.screen.height/2);var T=["#000","#FFF"],P=settings.loader&&settings.loader.colors||settings.loaderColors||T;Array.isArray(P)||(P=T);var O=d("./Color");x.setPalette([(new O).fromString(P[0]),(new O).fromString(P[1])]),paper(0),cls(),paper(1),pen(1),rect(_-S-2,M-4,2*S+4,8),r.preloadStaticAssets(i,function(t,f){if(paper(0).pen(1).cls(),t)return console.error(t),void print(t);window.assets=f,d("./spritesheet").unpackSpritesheets(),function(){var t=d("./Color"),e=settings.palette;if(e.file){for(var i=e.file.split("/"),n=f;n&&i.length;)n=n[i.shift()];if(!n)return;var o=n.width,r=n.height,s=n.x||0,u=n.y||0;n._isSprite&&(n=n.img);var a=d("./domUtils/createCanvas")(o,r).getContext("2d");a.drawImage(n,s,u,o,r,0,0,o,r);for(var l=a.getImageData(0,0,o,r).data,h=[],c=0;c<l.length;c+=4)l[c+3]<=1||h.push((new t).fromPixel(l,c));x.setPalette(h)}else{var p;for(p=e.colors?e.colors:e,h=[],c=0;c<p.length;c++)h.push((new t).fromString(p[c]));x.setPalette(h)}}(),f.tilesheet&&tilesheet(f.tilesheet),b.loadBank(f.maps);var e=d("./gamepad"),i=settings.gamepad||{};i.analogToDpad&&e.mapAnalogStickToDpad(i.deadZone);var n=d("../../src/main.js");n.update&&(v(),function t(){window.frameId+=1,e.update(),n.update(),v(),w(t)}())},function(t,e,i,n){rect(_-S-2,M-4,2*S+4,8),rectf(_-S,M-2,~~(n*S*2),4)})},{"../../src/main.js":33,"./Color":11,"./Texture":13,"./Texture/canvas2D":12,"./Texture/textCanvas2D":14,"./TileMap":15,"./assetLoader":16,"./domUtils/createCanvas":17,"./gamepad":18,"./inherits":19,"./projectData.json":20,"./spritesheet":22,"audio-manager":5}]},{},[38]);